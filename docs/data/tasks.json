{
  "tasks": [
    {
      "id": "f0ad33d5-6f9c-4174-884c-5203d606bcbc",
      "name": "常量定义修复",
      "description": "修复项目中缺失的测试常量定义，这是错误循环的根本原因之一。专注于src/constants/test-constants.ts文件，补全TEST_COUNTS、SHORT_DELAY、TIME_UNIT、STANDARD_HEIGHT等缺失常量。这个任务独立且原子化，可以并行执行。",
      "notes": "高优先级任务，可与其他基础修复任务并行执行。预计解决50+个TypeScript错误。建议独立提交，支持快速回滚。",
      "status": "pending",
      "dependencies": [],
      "createdAt": "2025-08-10T16:29:59.326Z",
      "updatedAt": "2025-08-10T16:29:59.326Z",
      "relatedFiles": [
        {
          "path": "src/constants/test-constants.ts",
          "type": "TO_MODIFY",
          "description": "补全缺失的常量定义",
          "lineStart": 500,
          "lineEnd": 541
        }
      ],
      "implementationGuide": "1. 在src/constants/test-constants.ts中添加缺失常量：\\nexport const TEST_COUNTS = { SMALL: 3, MEDIUM: 5, LARGE: 10, BATCH_SIZE: 20 } as const;\\nexport const TEST_TIMEOUT_CONSTANTS = { SHORT_DELAY: 100, MEDIUM_DELAY: 250, LONG_DELAY: 500 } as const;\\nexport const TEST_SCREEN_CONSTANTS = { STANDARD_HEIGHT: 768, MOBILE_WIDTH: 768, TABLET_WIDTH: 1024 } as const;\\n2. 添加Web Vitals诊断常量：\\nexport const TEST_WEB_VITALS_DIAGNOSTICS = { NETWORK_DOWNLINK: 4, NETWORK_RTT: 50, DEVICE_MEMORY: 8 } as const;\\n3. 验证：运行pnpm type-check，确认常量相关错误减少",
      "verificationCriteria": "1. 所有缺失常量已定义\\n2. 常量导入错误消失\\n3. pnpm type-check显示常量相关错误减少50+个",
      "analysisResult": "基于O3模型深度分析优化的项目质量修复：采用细粒度8任务分解结构，支持并行执行，降低风险，提高修复成功率。解决219个TypeScript错误、89个ESLint错误、77个测试失败，建立可持续质量管理体系。"
    },
    {
      "id": "9cd17485-2b60-40f8-b722-f04e2289be05",
      "name": "Web Vitals类型定义扩展",
      "description": "扩展Web Vitals相关的类型定义，修复WebVitalsSummary接口缺失属性问题。这是一个独立的类型定义任务，可以与常量修复并行执行。",
      "notes": "独立类型定义任务，可并行执行。专注解决Web Vitals诊断相关的类型错误。建议独立提交，支持快速回滚。",
      "status": "pending",
      "dependencies": [],
      "createdAt": "2025-08-10T16:29:59.326Z",
      "updatedAt": "2025-08-10T16:29:59.326Z",
      "relatedFiles": [
        {
          "path": "src/app/[locale]/diagnostics/utils.ts",
          "type": "TO_MODIFY",
          "description": "扩展WebVitalsSummary接口定义",
          "lineStart": 37,
          "lineEnd": 60
        }
      ],
      "implementationGuide": "1. 在src/app/[locale]/diagnostics/utils.ts中扩展WebVitalsSummary接口（兼容迁移到INP）：\\nexport interface WebVitalsSummary {\\n  metrics: WebVitalsMetrics;\\n  ratings: Record<string, MetricRating>;\\n  score: number;\\n  cls: number;\\n  lcp: number;\\n  fid?: number; // 历史兼容\\n  inp?: number; // 新版推荐\\n  fcp: number;\\n  ttfb: number;\\n}\\n2. 更新相关的类型导入和使用，逐步将FID迁移为INP\\n3. 验证：检查Web Vitals相关的TypeScript错误并更新测试用例",
      "verificationCriteria": "1. WebVitalsSummary接口包含所有必需属性\\n2. Web Vitals相关TypeScript错误解决\\n3. 诊断工具类型检查通过",
      "analysisResult": "基于O3模型深度分析优化的项目质量修复：采用细粒度8任务分解结构，支持并行执行，降低风险，提高修复成功率。解决219个TypeScript错误、89个ESLint错误、77个测试失败，建立可持续质量管理体系。"
    },
    {
      "id": "6c14ad80-0563-4676-8d2e-de234cd663ce",
      "name": "TinaCMS配置类型修复",
      "description": "修复TinaCMS配置中的exactOptionalPropertyTypes相关类型错误。这是一个独立的配置修复任务，专注于tina/config.ts文件的类型问题。",
      "notes": "独立配置修复任务，可并行执行。专注解决TinaCMS配置的类型安全问题。建议独立提交，支持快速回滚。",
      "status": "pending",
      "dependencies": [],
      "createdAt": "2025-08-10T16:29:59.326Z",
      "updatedAt": "2025-08-10T16:29:59.326Z",
      "relatedFiles": [
        {
          "path": "tina/config.ts",
          "type": "TO_MODIFY",
          "description": "修复TinaCMS配置类型错误",
          "lineStart": 214,
          "lineEnd": 284
        },
        {
          "path": "tina/config.ts",
          "type": "TO_MODIFY",
          "description": "修复document.slug访问问题",
          "lineStart": 404,
          "lineEnd": 421
        }
      ],
      "implementationGuide": "1. 修复tina/config.ts中的字段定义，确保符合exactOptionalPropertyTypes要求：\\n// 类型定义保持：ui?: UIConfig\\n// 赋值使用条件扩展：const config = { ...base, ...(hasUI && { ui: uiConfig }) }\\n// 避免显式undefined，使用条件扩展模式\\n2. 为必需的templates属性提供默认值或正确的类型定义\\n3. 修复document.slug属性访问问题\\n4. 验证：运行pnpm type-check确认TinaCMS相关错误解决",
      "verificationCriteria": "1. TinaCMS配置类型检查通过\\n2. exactOptionalPropertyTypes相关错误解决\\n3. document.slug访问正常",
      "analysisResult": "基于O3模型深度分析优化的项目质量修复：采用细粒度8任务分解结构，支持并行执行，降低风险，提高修复成功率。解决219个TypeScript错误、89个ESLint错误、77个测试失败，建立可持续质量管理体系。"
    },
    {
      "id": "05285155-9a22-49c7-96e0-64a05447bde8",
      "name": "Hook类型接口修复",
      "description": "修正useIntersectionObserver Hook的返回类型定义，解决ref属性类型不匹配问题。将RefObject类型改为回调函数类型，符合实际实现。",
      "notes": "依赖常量定义完成。这个修复将解决Hook接口不匹配的核心问题。建议独立提交，支持快速回滚。",
      "status": "pending",
      "dependencies": [
        {
          "taskId": "f0ad33d5-6f9c-4174-884c-5203d606bcbc"
        }
      ],
      "createdAt": "2025-08-10T16:29:59.326Z",
      "updatedAt": "2025-08-10T16:29:59.326Z",
      "relatedFiles": [
        {
          "path": "src/hooks/use-intersection-observer.ts",
          "type": "TO_MODIFY",
          "description": "修正Hook返回类型接口定义",
          "lineStart": 30,
          "lineEnd": 40
        },
        {
          "path": "src/hooks/use-intersection-observer.ts",
          "type": "TO_MODIFY",
          "description": "确保返回callbackRef",
          "lineStart": 180,
          "lineEnd": 186
        }
      ],
      "implementationGuide": "1. 修正src/hooks/use-intersection-observer.ts中的接口定义：\\nexport interface IntersectionObserverHookReturn<T extends Element> {\\n  ref: (node: T | null) => void;  // 改为回调函数\\n  isVisible: boolean;\\n  hasBeenVisible: boolean;\\n}\\n2. 确保Hook实现返回callbackRef而非useRef\\n3. 验证：检查Hook相关的TypeScript错误",
      "verificationCriteria": "1. Hook接口类型正确\\n2. ref属性为回调函数类型\\n3. Hook相关TypeScript错误解决",
      "analysisResult": "基于O3模型深度分析优化的项目质量修复：采用细粒度8任务分解结构，支持并行执行，降低风险，提高修复成功率。解决219个TypeScript错误、89个ESLint错误、77个测试失败，建立可持续质量管理体系。"
    },
    {
      "id": "04ca03a3-96f4-43cd-838d-05ab8458a89b",
      "name": "测试Mock配置标准化",
      "description": "标准化测试Mock配置，应用vi.hoisted模式，完善PerformanceObserver等全局Mock实现。这个任务可以与Hook修复部分并行执行。",
      "notes": "可与Hook修复并行执行。专注于测试基础设施的标准化。建议独立提交，支持快速回滚。",
      "status": "pending",
      "dependencies": [
        {
          "taskId": "f0ad33d5-6f9c-4174-884c-5203d606bcbc"
        }
      ],
      "createdAt": "2025-08-10T16:29:59.326Z",
      "updatedAt": "2025-08-10T16:29:59.326Z",
      "relatedFiles": [
        {
          "path": "src/test/setup.ts",
          "type": "TO_MODIFY",
          "description": "完善PerformanceObserver Mock",
          "lineStart": 150,
          "lineEnd": 160
        },
        {
          "path": "src/test/mock-templates.tsx",
          "type": "TO_MODIFY",
          "description": "修复mockName赋值问题",
          "lineStart": 360,
          "lineEnd": 365
        }
      ],
      "implementationGuide": "1. 更新src/test/setup.ts中的PerformanceObserver Mock：\\nglobal.PerformanceObserver = vi.fn().mockImplementation((callback) => ({\\n  observe: vi.fn(),\\n  disconnect: vi.fn(),\\n  unobserve: vi.fn()\\n}));\\n(global.PerformanceObserver as any).supportedEntryTypes = ['navigation', 'resource'];\\n2. 标准化各测试文件的Mock配置，使用vi.hoisted模式\\n3. 修复mockName赋值问题\\n4. 验证：运行相关测试确保Mock正常工作",
      "verificationCriteria": "1. PerformanceObserver Mock完整\\n2. vi.hoisted模式应用\\n3. Mock相关错误解决",
      "analysisResult": "基于O3模型深度分析优化的项目质量修复：采用细粒度8任务分解结构，支持并行执行，降低风险，提高修复成功率。解决219个TypeScript错误、89个ESLint错误、77个测试失败，建立可持续质量管理体系。"
    },
    {
      "id": "f3c21269-1256-444b-b7b9-3ab9dd755ea3",
      "name": "ESLint规则修复和代码质量提升",
      "description": "修复ESLint规则违反问题，包括魔法数字、函数复杂度、未使用变量等。使用已修复的常量替换魔法数字，重构复杂函数。",
      "notes": "依赖常量和Hook修复完成。这个任务将解决大部分ESLint问题。建议独立提交，支持快速回滚。",
      "status": "pending",
      "dependencies": [
        {
          "taskId": "f0ad33d5-6f9c-4174-884c-5203d606bcbc"
        },
        {
          "taskId": "05285155-9a22-49c7-96e0-64a05447bde8"
        },
        {
          "taskId": "04ca03a3-96f4-43cd-838d-05ab8458a89b"
        }
      ],
      "createdAt": "2025-08-10T16:29:59.326Z",
      "updatedAt": "2025-08-10T16:29:59.326Z",
      "relatedFiles": [
        {
          "path": "src/components/responsive-layout.tsx",
          "type": "TO_MODIFY",
          "description": "降低函数复杂度，修复Hook规则",
          "lineStart": 27,
          "lineEnd": 60
        },
        {
          "path": "src/hooks/use-keyboard-navigation.ts",
          "type": "TO_MODIFY",
          "description": "重构复杂函数",
          "lineStart": 43,
          "lineEnd": 180
        },
        {
          "path": "src/lib/__tests__/enhanced-web-vitals.test.ts",
          "type": "TO_MODIFY",
          "description": "替换魔法数字",
          "lineStart": 150,
          "lineEnd": 200
        }
      ],
      "implementationGuide": "1. 替换魔法数字为常量：\\n// 使用TEST_TIMEOUT_CONSTANTS.SHORT_DELAY替换100\\n// 使用TEST_COUNTS.SMALL替换硬编码的3\\n2. 重构复杂度超过15的函数：\\n// src/hooks/use-keyboard-navigation.ts中的复杂函数\\n// src/components/responsive-layout.tsx中的复杂逻辑\\n3. 移除未使用的变量和导入\\n4. 修复React Hook依赖数组问题\\n5. 验证：运行pnpm lint:strict确保0警告",
      "verificationCriteria": "1. pnpm lint:strict通过，0警告\\n2. 函数复杂度≤15\\n3. 无魔法数字\\n4. 无未使用变量",
      "analysisResult": "基于O3模型深度分析优化的项目质量修复：采用细粒度8任务分解结构，支持并行执行，降低风险，提高修复成功率。解决219个TypeScript错误、89个ESLint错误、77个测试失败，建立可持续质量管理体系。"
    },
    {
      "id": "5f288aa1-4cf6-4749-b34a-31bfaad63b7b",
      "name": "测试失败修复和Mock完善",
      "description": "修复剩余的测试失败，完善Mock系统。重点修复ResponsiveLayout、i18n-cache、Web Vitals诊断等测试。这个任务可以与ESLint修复并行执行。",
      "notes": "可与ESLint修复并行执行。专注于测试系统的稳定性。建议独立提交，支持快速回滚。",
      "status": "pending",
      "dependencies": [
        {
          "taskId": "f0ad33d5-6f9c-4174-884c-5203d606bcbc"
        },
        {
          "taskId": "05285155-9a22-49c7-96e0-64a05447bde8"
        },
        {
          "taskId": "04ca03a3-96f4-43cd-838d-05ab8458a89b"
        }
      ],
      "createdAt": "2025-08-10T16:29:59.326Z",
      "updatedAt": "2025-08-10T16:29:59.326Z",
      "relatedFiles": [
        {
          "path": "src/components/__tests__/responsive-layout.test.tsx",
          "type": "TO_MODIFY",
          "description": "修复组件测试失败",
          "lineStart": 50,
          "lineEnd": 200
        },
        {
          "path": "src/lib/__tests__/i18n-cache.test.ts",
          "type": "TO_MODIFY",
          "description": "完善Mock配置和返回值",
          "lineStart": 200,
          "lineEnd": 300
        },
        {
          "path": "src/hooks/__tests__/use-web-vitals-diagnostics.test.ts",
          "type": "TO_MODIFY",
          "description": "修复诊断测试类型问题",
          "lineStart": 300,
          "lineEnd": 400
        }
      ],
      "implementationGuide": "1. 修复ResponsiveLayout测试：\\n// 确保isBelow函数正确Mock\\n// 更新测试期望值匹配实际渲染结果\\n2. 完善i18n-cache测试Mock：\\n// 修复Mock返回值类型\\n// 确保metrics方法返回正确数据\\n3. 修复Web Vitals诊断测试：\\n// 使用正确的常量\\n// 修复PerformanceTrends类型问题\\n4. 处理错误边界测试的环境变量问题\\n5. 验证：运行pnpm test确保所有测试通过",
      "verificationCriteria": "1. pnpm test全部通过\\n2. 测试覆盖率≥85%\\n3. Mock系统稳定\\n4. 无测试超时错误",
      "analysisResult": "基于O3模型深度分析优化的项目质量修复：采用细粒度8任务分解结构，支持并行执行，降低风险，提高修复成功率。解决219个TypeScript错误、89个ESLint错误、77个测试失败，建立可持续质量管理体系。"
    },
    {
      "id": "966b6953-440a-4f5f-b90b-15aff446dd45",
      "name": "构建验证和质量保障",
      "description": "最终验证所有修复的有效性，确保项目达到生产就绪状态。运行完整的质量检查流程，建立错误预防机制。",
      "notes": "最终验证任务，确保项目整体健康度≥90/100。依赖所有前置修复完成。",
      "status": "pending",
      "dependencies": [
        {
          "taskId": "f3c21269-1256-444b-b7b9-3ab9dd755ea3"
        },
        {
          "taskId": "5f288aa1-4cf6-4749-b34a-31bfaad63b7b"
        }
      ],
      "createdAt": "2025-08-10T16:29:59.326Z",
      "updatedAt": "2025-08-10T16:29:59.326Z",
      "relatedFiles": [
        {
          "path": "package.json",
          "type": "REFERENCE",
          "description": "验证所有脚本命令",
          "lineStart": 1,
          "lineEnd": 121
        },
        {
          "path": "tsconfig.json",
          "type": "REFERENCE",
          "description": "验证TypeScript配置",
          "lineStart": 1,
          "lineEnd": 60
        }
      ],
      "implementationGuide": "1. 清理构建缓存：git clean -xfd && rm -rf **/*.tsbuildinfo\\n2. 运行完整质量检查：pnpm quality:full（如缺失则改用：pnpm lint && pnpm type-check && pnpm test && pnpm build）\\n3. 验证构建成功：pnpm build\\n4. 检查包大小：pnpm size:check（如缺失暂跳过或改用 @next/bundle-analyzer 本地校验）\\n5. 验证架构一致性：pnpm arch:validate（如缺失暂跳过）\\n6. 运行安全检查：pnpm security:check（如缺失可改为 pnpm audit --audit-level=moderate）\\n7. 运行RSC边界lint：pnpm run lint:rsc\\n8. 路径别名一致性检查：pnpm run alias:check\\n9. 生成质量报告\\n10. 建立CI/CD质量门禁\\n11. 文档化修复过程",
      "verificationCriteria": "1. pnpm quality:full成功\\n2. pnpm build成功\\n3. 项目健康度≥90/100\\n4. 所有质量门禁通过\\n5. 错误预防机制建立",
      "analysisResult": "基于O3模型深度分析优化的项目质量修复：采用细粒度8任务分解结构，支持并行执行，降低风险，提高修复成功率。解决219个TypeScript错误、89个ESLint错误、77个测试失败，建立可持续质量管理体系。"
    }
  ]
}
