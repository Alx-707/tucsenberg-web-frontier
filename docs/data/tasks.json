{
  "tasks": [
    {
      "id": "f253daeb-db2e-4708-ab6c-6d03518c4766",
      "name": "Refactor accessibility-test to Server shell + ClientPage",
      "description": "将 app/[locale]/accessibility-test/page.tsx 拆分为 Server 外壳与 Client 子组件，确保 notFound() 仅在 Server 上下文触发（生产 404，开发可用）。",
      "status": "pending",
      "dependencies": [],
      "createdAt": "2025-10-30T00:51:57.088Z",
      "updatedAt": "2025-10-30T00:51:57.088Z",
      "relatedFiles": [
        {
          "path": "src/app/[locale]/accessibility-test/page.tsx",
          "type": "TO_MODIFY",
          "description": "Server shell hosting notFound and rendering ClientPage"
        },
        {
          "path": "src/app/[locale]/accessibility-test/ClientPage.tsx",
          "type": "CREATE",
          "description": "Client UI moved from old page.tsx"
        }
      ],
      "implementationGuide": "pseudocode:\n- Create app/[locale]/accessibility-test/ClientPage.tsx ('use client') and move current UI there.\n- Update page.tsx (Server, no 'use client'):\n  import { notFound } from 'next/navigation'\n  if (process.env.NODE_ENV==='production') notFound()\n  return <ClientPage/>\n- Keep existing imports for test sections; adjust relative paths.",
      "verificationCriteria": "开发环境可正常运行测试；生产构建后访问该路径返回 404；无控制台/构建错误。",
      "analysisResult": "Next.js 15 + React 19 内容/表单型站点最小变更优化：先修复可观测性与错误边界，再做按需性能与代码组织优化，保证可回滚与可验证。"
    },
    {
      "id": "1d808fcc-fe69-447d-9301-7b59c249bb66",
      "name": "Server Actions: add server-side Sentry capture",
      "description": "在 src/app/actions.ts 的 catch 分支增加 Sentry.captureException(error)（仅服务器侧），保留结构化 logger。",
      "status": "pending",
      "dependencies": [],
      "createdAt": "2025-10-30T00:51:57.088Z",
      "updatedAt": "2025-10-30T00:51:57.088Z",
      "relatedFiles": [
        {
          "path": "src/app/actions.ts",
          "type": "TO_MODIFY",
          "description": "Add captureException in catch branch"
        },
        {
          "path": "sentry.server.config.ts",
          "type": "REFERENCE",
          "description": "Server Sentry setup reference"
        }
      ],
      "implementationGuide": "pseudocode:\n- import * as Sentry from '@sentry/nextjs' (server-only bundle).\n- In catch(error): Sentry.captureException(error) then logger.error(...).\n- Ensure sentry.server.config.ts already initializes in production (no DSN -> no-op).",
      "verificationCriteria": "本地/预览以 mock 或条件断点验证 captureException 被调用；生产具备 DSN 时错误可在 Sentry 可见；单测/类型/构建通过。",
      "analysisResult": "Next.js 15 + React 19 内容/表单型站点最小变更优化：先修复可观测性与错误边界，再做按需性能与代码组织优化，保证可回滚与可验证。"
    },
    {
      "id": "304ac9e5-f769-414f-81de-9615975fcfa4",
      "name": "Add route-level error boundaries for contact/products",
      "description": "在 app/[locale]/contact 与 app/[locale]/products 路由段新增 error.tsx（'use client'），提供 Retry/返回首页。",
      "status": "pending",
      "dependencies": [],
      "createdAt": "2025-10-30T00:51:57.088Z",
      "updatedAt": "2025-10-30T00:51:57.088Z",
      "relatedFiles": [
        {
          "path": "src/app/[locale]/contact/error.tsx",
          "type": "CREATE",
          "description": "Route-level error boundary for contact"
        },
        {
          "path": "src/app/[locale]/products/error.tsx",
          "type": "CREATE",
          "description": "Route-level error boundary for products"
        }
      ],
      "implementationGuide": "pseudocode:\n- Create app/[locale]/contact/error.tsx and products/error.tsx:\n  'use client'\n  export default function Error({error,reset}) { return <div> <p>Something went wrong.</p><button onClick={reset}>Retry</button></div> }\n- Style with existing Button if desired.",
      "verificationCriteria": "在对应段手动抛错仅出现局部错误 UI；点击 Retry 恢复；不触发全局 global-error.tsx。",
      "analysisResult": "Next.js 15 + React 19 内容/表单型站点最小变更优化：先修复可观测性与错误边界，再做按需性能与代码组织优化，保证可回滚与可验证。"
    },
    {
      "id": "ec1e5b9b-8734-4564-b454-2e8ec603b500",
      "name": "Contact page rendering strategy review (PPR/static)",
      "description": "评估并调整 contact 页渲染策略：若文案稳定且仅表单为动态，移除 dynamic='force-dynamic' 或改用 PPR；确保表单/Turnstile 流程不受影响。",
      "status": "pending",
      "dependencies": [
        {
          "taskId": "f253daeb-db2e-4708-ab6c-6d03518c4766"
        }
      ],
      "createdAt": "2025-10-30T00:51:57.088Z",
      "updatedAt": "2025-10-30T00:51:57.088Z",
      "relatedFiles": [
        {
          "path": "src/app/[locale]/contact/page.tsx",
          "type": "TO_MODIFY",
          "description": "Adjust dynamic strategy (remove force-dynamic or PPR)"
        }
      ],
      "implementationGuide": "pseudocode:\n- Audit contact/page.tsx usage of getTranslations and dynamic behaviors.\n- Option A: remove export const dynamic='force-dynamic'.\n- Option B: adopt PPR segment config if needed.\n- Verify Turnstile + Server Actions still function. Provide rollback if issues.",
      "verificationCriteria": "构建与类型检查通过；FCP/TTFB 无显著回退；表单提交与 Turnstile 验证保持可用。",
      "analysisResult": "Next.js 15 + React 19 内容/表单型站点最小变更优化：先修复可观测性与错误边界，再做按需性能与代码组织优化，保证可回滚与可验证。"
    },
    {
      "id": "cf0dbc90-a86d-464d-9f7c-8d6eb3232643",
      "name": "Create server util: getTranslationsCached()",
      "description": "新增基于 React cache() 的翻译获取工具，统一封装 next-intl/server 的 getTranslations，减少重复样板。",
      "status": "pending",
      "dependencies": [],
      "createdAt": "2025-10-30T00:51:57.088Z",
      "updatedAt": "2025-10-30T00:51:57.088Z",
      "relatedFiles": [
        {
          "path": "src/lib/i18n/server/getTranslationsCached.ts",
          "type": "CREATE",
          "description": "React cache wrapper for getTranslations"
        },
        {
          "path": "src/app/[locale]/about/page.tsx",
          "type": "TO_MODIFY",
          "description": "Replace direct getTranslations with cached util"
        },
        {
          "path": "src/app/[locale]/contact/page.tsx",
          "type": "TO_MODIFY",
          "description": "Replace direct getTranslations with cached util"
        },
        {
          "path": "src/app/[locale]/products/page.tsx",
          "type": "TO_MODIFY",
          "description": "Replace direct getTranslations with cached util"
        }
      ],
      "implementationGuide": "pseudocode:\n- Add src/lib/i18n/server/getTranslationsCached.ts:\n  import { cache } from 'react'\n  import { getTranslations as getT } from 'next-intl/server'\n  export const getTranslationsCached = cache((args)=>getT(args))\n- Replace page-level getTranslations usages where duplication exists (about/contact/products).",
      "verificationCriteria": "页面功能等价；减少重复代码；不改变 next-intl 中间件行为；构建/测试通过。",
      "analysisResult": "Next.js 15 + React 19 内容/表单型站点最小变更优化：先修复可观测性与错误边界，再做按需性能与代码组织优化，保证可回滚与可验证。"
    },
    {
      "id": "19ee8b48-2ec7-4d04-bbff-186b4bdea8c0",
      "name": "Tag heavy dynamic islands with { ssr:false }",
      "description": "为非首屏关键且较重的动态组件，使用 createStandardDynamicComponent 传入 { ssr:false }，降低首屏竞争。",
      "status": "pending",
      "dependencies": [],
      "createdAt": "2025-10-30T00:51:57.088Z",
      "updatedAt": "2025-10-30T00:51:57.088Z",
      "relatedFiles": [
        {
          "path": "src/components/shared/dynamic-imports-base.tsx",
          "type": "REFERENCE",
          "description": "Dynamic factory reference"
        },
        {
          "path": "src/components/shared/dynamic-imports-core.tsx",
          "type": "TO_MODIFY",
          "description": "Update component dynamic options to include ssr:false where needed"
        },
        {
          "path": "src/components/shared/dynamic-imports.tsx",
          "type": "TO_MODIFY",
          "description": "Ensure exports align with updated options"
        }
      ],
      "implementationGuide": "pseudocode:\n- Identify candidates in dynamic-imports-* (e.g., Carousel/Dropdown-heavy).\n- Update their dynamic factory options: { ssr:false, loading: MinimalLoadingFallback }.\n- Verify SEO impact is acceptable (keep content primary server-rendered).",
      "verificationCriteria": "首屏可交互时间有改善或持平；重型组件在客户端正常加载；无 SSR 相关回退。",
      "analysisResult": "Next.js 15 + React 19 内容/表单型站点最小变更优化：先修复可观测性与错误边界，再做按需性能与代码组织优化，保证可回滚与可验证。"
    },
    {
      "id": "d0f7f0b2-5f6e-4245-8e7b-bec803571ac4",
      "name": "Remove or internalize AllDynamicComponents aggregation",
      "description": "确认仓库未引用 AllDynamicComponents 后删除该聚合导出；若需保留则标注 internal-only 并通过 lint 限制外部引用。",
      "status": "pending",
      "dependencies": [
        {
          "taskId": "19ee8b48-2ec7-4d04-bbff-186b4bdea8c0"
        }
      ],
      "createdAt": "2025-10-30T00:51:57.088Z",
      "updatedAt": "2025-10-30T00:51:57.088Z",
      "relatedFiles": [
        {
          "path": "src/components/shared/dynamic-imports.tsx",
          "type": "TO_MODIFY",
          "description": "Remove AllDynamicComponents or mark as internal-only"
        }
      ],
      "implementationGuide": "pseudocode:\n- rg 查全仓库引用；若为 0：删除聚合对象导出与相关代码。\n- 若需保留：在文件顶部注释 'INTERNAL-ONLY' 并在 eslint 配置增加 import 限制。",
      "verificationCriteria": "构建无找不到符号错误；bundle 不含不必要聚合；lint 通过（若保留 internal-only 方案）。",
      "analysisResult": "Next.js 15 + React 19 内容/表单型站点最小变更优化：先修复可观测性与错误边界，再做按需性能与代码组织优化，保证可回滚与可验证。"
    },
    {
      "id": "9d5ec98c-055d-4fce-a667-75f3fb44468b",
      "name": "Contact form: centralize rate-limit constants & i18n error mapping",
      "description": "集中化表单频控常量（复用现有 COUNT/SECONDS 常量体系），将 Zod 校验 issue 映射到 i18n 错误键（errors.*）；可选加入 useThrottle 包装提交。",
      "status": "pending",
      "dependencies": [
        {
          "taskId": "1d808fcc-fe69-447d-9301-7b59c249bb66"
        }
      ],
      "createdAt": "2025-10-30T00:51:57.088Z",
      "updatedAt": "2025-10-30T00:51:57.088Z",
      "relatedFiles": [
        {
          "path": "src/components/forms/contact-form-container.tsx",
          "type": "TO_MODIFY",
          "description": "Centralize rate-limit constants and optional throttle"
        },
        {
          "path": "src/app/actions.ts",
          "type": "TO_MODIFY",
          "description": "Map zod issues to i18n error keys"
        }
      ],
      "implementationGuide": "pseudocode:\n- In contact-form-container.tsx, replace inline formula params with constants from src/constants/index.ts.\n- In src/app/actions.ts validation, map zod issues to i18n keys (e.g., 'errors.firstName.required').\n- Optional: implement useThrottle for enhancedFormAction wrapper.",
      "verificationCriteria": "功能等价或更好；错误提示可国际化；重复提交受控；测试/构建通过。",
      "analysisResult": "Next.js 15 + React 19 内容/表单型站点最小变更优化：先修复可观测性与错误边界，再做按需性能与代码组织优化，保证可回滚与可验证。"
    },
    {
      "id": "47b76c5e-8505-439b-be93-203bb93ab31e",
      "name": "Author domain-service/Server Actions boundary documentation",
      "description": "在 docs/ 补充领域服务（纯函数）→ Server Actions 薄适配 → UI 的分层文档，明确未来迁移的抽象边界。",
      "status": "pending",
      "dependencies": [],
      "createdAt": "2025-10-30T00:51:57.088Z",
      "updatedAt": "2025-10-30T00:51:57.088Z",
      "relatedFiles": [
        {
          "path": "docs/development/server-actions-architecture.md",
          "type": "CREATE",
          "description": "Architecture boundary documentation"
        }
      ],
      "implementationGuide": "pseudocode:\n- Create docs/development/server-actions-architecture.md with diagram and examples.\n- Document how processFormSubmission serves as domain service and how actions.ts adapts it.",
      "verificationCriteria": "文档结构清晰、示例可运行（伪代码即可）、团队可据此规划迁移。",
      "analysisResult": "Next.js 15 + React 19 内容/表单型站点最小变更优化：先修复可观测性与错误边界，再做按需性能与代码组织优化，保证可回滚与可验证。"
    }
  ]
}