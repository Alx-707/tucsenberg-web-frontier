# ğŸ¯ æ¶æ„é‡æ„æœ€ä½³å®è·µ

## ğŸ“ ä»£ç ç»„ç»‡åŸåˆ™

### åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDDDï¼‰
```
src/lib/
â”œâ”€â”€ security/           # å®‰å…¨åŸŸ
â”‚   â”œâ”€â”€ index.ts       # å…¬å¼€API
â”‚   â”œâ”€â”€ types.ts       # ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ core.ts        # æ ¸å¿ƒåŠŸèƒ½
â”‚   â””â”€â”€ utils.ts       # å·¥å…·å‡½æ•°
â”œâ”€â”€ i18n/              # å›½é™…åŒ–åŸŸ
â”‚   â”œâ”€â”€ index.ts
â”‚   â”œâ”€â”€ types.ts
â”‚   â”œâ”€â”€ cache/         # ç¼“å­˜å­åŸŸ
â”‚   â”œâ”€â”€ preloader/     # é¢„åŠ è½½å­åŸŸ
â”‚   â””â”€â”€ monitoring/    # ç›‘æ§å­åŸŸ
â””â”€â”€ ...
```

### æ–‡ä»¶å‘½åè§„èŒƒ
- **åŸŸæ–‡ä»¶**ï¼š`domain-name/index.ts`
- **ç±»å‹æ–‡ä»¶**ï¼š`domain-name/types.ts`
- **å­åŸŸæ–‡ä»¶**ï¼š`domain-name/subdomain/index.ts`
- **å·¥å…·æ–‡ä»¶**ï¼š`domain-name/utils.ts`

## ğŸ”„ å¯¼å…¥å¯¼å‡ºè§„èŒƒ

### âœ… æ¨èåšæ³•

#### ä½¿ç”¨å‘½åå¯¼å‡º
```typescript
// âœ… å¥½çš„åšæ³•
export { validateInput, sanitizeData } from './validation';
export { encryptData, decryptData } from './encryption';

// âŒ é¿å…çš„åšæ³•
export * from './validation';
export * from './encryption';
```

#### ä½¿ç”¨@/è·¯å¾„åˆ«å
```typescript
// âœ… å¥½çš„åšæ³•
import { validateInput } from '@/lib/security/validation';
import type { SecurityConfig } from '@/lib/security/types';

// âŒ é¿å…çš„åšæ³•
import { validateInput } from '../../../lib/security/validation';
import { SecurityConfig } from '../../../lib/security/types';
```

#### æ­£ç¡®ä½¿ç”¨import type
```typescript
// âœ… å¥½çš„åšæ³• - ä»…ç±»å‹å¯¼å…¥
import type { User, UserConfig } from '@/types/user';
import { createUser } from '@/lib/user';

// âŒ é¿å…çš„åšæ³• - æ··åˆå¯¼å…¥
import { User, UserConfig, createUser } from '@/lib/user';
```

### ğŸ—ï¸ æ¶æ„è¾¹ç•Œè§„åˆ™

#### åŸŸé—´è®¿é—®è§„åˆ™
```typescript
// âœ… å…è®¸ï¼šé€šè¿‡å…¬å¼€APIè®¿é—®
import { validateInput } from '@/lib/security';

// âŒ ç¦æ­¢ï¼šç›´æ¥è®¿é—®å†…éƒ¨å®ç°
import { validateInput } from '@/lib/security/internal/validator';

// âœ… å…è®¸ï¼šè®¿é—®å…±äº«å·¥å…·
import { formatDate } from '@/lib/utils';
import type { BaseConfig } from '@/lib/types';
```

#### ä¾èµ–æ–¹å‘è§„åˆ™
```
åº”ç”¨å±‚ (app/) â†’ é¢†åŸŸå±‚ (lib/) â†’ åŸºç¡€å±‚ (utils/, types/)
     â†“              â†“                â†“
ä¸èƒ½åå‘ä¾èµ–    ä¸èƒ½åå‘ä¾èµ–      å¯ä»¥è¢«ä»»ä½•å±‚ä½¿ç”¨
```

## ğŸ”§ é‡æ„æ“ä½œæŒ‡å—

### ç¬¬ä¸€æ­¥ï¼šåˆ†æç°çŠ¶
```bash
# è¿è¡Œåº¦é‡åˆ†æ
pnpm arch:metrics

# æ£€æŸ¥ä¾èµ–å…³ç³»
pnpm arch:check

# åˆ†æexport *ä½¿ç”¨æƒ…å†µ
grep -r "export \*" src/lib/ | wc -l
```

### ç¬¬äºŒæ­¥ï¼šåˆ¶å®šè®¡åˆ’
1. **è¯†åˆ«é‡æ„åŸŸ**ï¼šé€‰æ‹©æ–‡ä»¶æ•°é‡é€‚ä¸­çš„åŸŸå¼€å§‹
2. **è®¾è®¡ç›®æ ‡ç»“æ„**ï¼šè§„åˆ’æ–°çš„ç›®å½•å’Œæ–‡ä»¶ç»„ç»‡
3. **è¯„ä¼°å½±å“èŒƒå›´**ï¼šåˆ†æä¾èµ–å…³ç³»å’Œå½±å“é¢
4. **åˆ¶å®šè¿ç§»ç­–ç•¥**ï¼šç¡®å®šè¿ç§»æ­¥éª¤å’Œæ—¶é—´è¡¨

### ç¬¬ä¸‰æ­¥ï¼šæ‰§è¡Œé‡æ„
```bash
# 1. åˆ›å»ºæ–°ç»“æ„
mkdir -p src/lib/domain-name/{cache,types,utils}

# 2. è½¬æ¢export *
pnpm transform:barrel:dry  # é¢„è§ˆ
pnpm transform:barrel      # æ‰§è¡Œ

# 3. ç»Ÿä¸€å¯¼å…¥è·¯å¾„
pnpm normalize:imports

# 4. éªŒè¯ç»“æœ
pnpm ci:quality
```

### ç¬¬å››æ­¥ï¼šå»ºç«‹å…¼å®¹å±‚
```typescript
// src/lib/old-file.ts
/**
 * @deprecated è¯·ä½¿ç”¨ @/lib/domain-name æ›¿ä»£
 * æ­¤æ–‡ä»¶å°†åœ¨v2.0ç‰ˆæœ¬ä¸­ç§»é™¤
 */
export * from '@/lib/domain-name';
```

### ç¬¬äº”æ­¥ï¼šæ‰¹é‡æ›´æ–°
```bash
# ä½¿ç”¨codemodæ‰¹é‡æ›´æ–°å¯¼å…¥è·¯å¾„
node scripts/migrate-imports.js --domain=domain-name
```

### ç¬¬å…­æ­¥ï¼šæ¸…ç†å’ŒéªŒè¯
```bash
# è¿è¡Œå®Œæ•´æµ‹è¯•
pnpm test

# æ£€æŸ¥æ€§èƒ½å½±å“
pnpm perf:check

# æ›´æ–°åº¦é‡åŸºçº¿
pnpm arch:metrics
```

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### é‡æ„å‰æµ‹è¯•
```bash
# å»ºç«‹æµ‹è¯•åŸºçº¿
pnpm test --coverage
pnpm test:e2e

# è®°å½•æ€§èƒ½åŸºçº¿
pnpm perf:benchmark
```

### é‡æ„ä¸­æµ‹è¯•
```bash
# å¢é‡æµ‹è¯•
pnpm test:watch

# å¿«é€Ÿè´¨é‡æ£€æŸ¥
pnpm quality:quick:staged
```

### é‡æ„åéªŒè¯
```bash
# å®Œæ•´å›å½’æµ‹è¯•
pnpm test:all

# æ€§èƒ½å¯¹æ¯”æµ‹è¯•
pnpm perf:compare

# ç«¯åˆ°ç«¯æµ‹è¯•
pnpm test:e2e
```

## ğŸ“Š è´¨é‡é—¨ç¦

### å¿…é¡»é€šè¿‡çš„æ£€æŸ¥
- [ ] TypeScriptç¼–è¯‘æ— é”™è¯¯
- [ ] ESLintæ£€æŸ¥é€šè¿‡
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] æµ‹è¯•è¦†ç›–ç‡ä¸é™ä½
- [ ] æ„å»ºæˆåŠŸ
- [ ] åŒ…å¤§å°ä¸è¶…å‡ºé¢„ç®—

### æ€§èƒ½è¦æ±‚
- [ ] æ„å»ºæ—¶é—´ä¸å¢åŠ è¶…è¿‡5%
- [ ] åŒ…å¤§å°ä¸å¢åŠ è¶…è¿‡2%
- [ ] IDEå“åº”æ—¶é—´ä¸é™ä½

### ä»£ç è´¨é‡è¦æ±‚
- [ ] åœˆå¤æ‚åº¦ä¸è¶…è¿‡15
- [ ] å‡½æ•°é•¿åº¦ä¸è¶…è¿‡120è¡Œ
- [ ] å‚æ•°æ•°é‡ä¸è¶…è¿‡5ä¸ª
- [ ] åµŒå¥—æ·±åº¦ä¸è¶…è¿‡4å±‚

## ğŸš¨ å¸¸è§é™·é˜±ä¸è§£å†³æ–¹æ¡ˆ

### é™·é˜±1ï¼šè¿‡åº¦é‡æ„
**é—®é¢˜**ï¼šä¸€æ¬¡æ€§é‡æ„å¤ªå¤šæ–‡ä»¶ï¼Œå¯¼è‡´PRè¿‡å¤§éš¾ä»¥å®¡æŸ¥

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ä¸¥æ ¼æ§åˆ¶PRå¤§å°ï¼ˆ300-600è¡Œï¼‰
- æŒ‰åŸŸåˆ†æ‰¹é‡æ„
- ä½¿ç”¨feature branchéš”ç¦»å˜æ›´

### é™·é˜±2ï¼šç ´åæ€§å˜æ›´
**é—®é¢˜**ï¼šé‡æ„å¯¼è‡´ç°æœ‰åŠŸèƒ½å¼‚å¸¸

**è§£å†³æ–¹æ¡ˆ**ï¼š
- å»ºç«‹è¿‡æ¸¡æœŸå…¼å®¹å±‚
- ä¿æŒAPIå‘åå…¼å®¹
- å®Œæ•´çš„å›å½’æµ‹è¯•

### é™·é˜±3ï¼šå¾ªç¯ä¾èµ–
**é—®é¢˜**ï¼šé‡æ„åå‡ºç°å¾ªç¯ä¾èµ–

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ä½¿ç”¨dependency-cruiseræ£€æµ‹
- æå–å…±äº«ç±»å‹åˆ°ç‹¬ç«‹æ–‡ä»¶
- é‡æ–°è®¾è®¡æ¨¡å—è¾¹ç•Œ

### é™·é˜±4ï¼šæ€§èƒ½å›å½’
**é—®é¢˜**ï¼šé‡æ„å¯¼è‡´æ„å»ºæˆ–è¿è¡Œæ—¶æ€§èƒ½ä¸‹é™

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æŒç»­æ€§èƒ½ç›‘æ§
- åŸºå‡†æµ‹è¯•å¯¹æ¯”
- åŠæ—¶ä¼˜åŒ–çƒ­ç‚¹

## ğŸ“ˆ æˆåŠŸæŒ‡æ ‡

### çŸ­æœŸæŒ‡æ ‡ï¼ˆæ¯å‘¨ï¼‰
- Export * æ•°é‡å‡å°‘
- TypeScripté”™è¯¯æ•°é‡å‡å°‘
- ESLinté—®é¢˜æ•°é‡å‡å°‘
- æ„å»ºæ—¶é—´æ”¹å–„

### ä¸­æœŸæŒ‡æ ‡ï¼ˆæ¯æœˆï¼‰
- æ–‡ä»¶æ•°é‡ä¼˜åŒ–
- æµ‹è¯•è¦†ç›–ç‡æå‡
- å¼€å‘æ•ˆç‡æå‡
- ä»£ç å®¡æŸ¥æ—¶é—´å‡å°‘

### é•¿æœŸæŒ‡æ ‡ï¼ˆæ¯å­£åº¦ï¼‰
- æ•´ä½“æ¶æ„æ¸…æ™°åº¦
- æ–°åŠŸèƒ½å¼€å‘é€Ÿåº¦
- Bugä¿®å¤æ•ˆç‡
- å›¢é˜Ÿæ»¡æ„åº¦

---

**è®°ä½**ï¼šé‡æ„æ˜¯æŒç»­æ”¹è¿›çš„è¿‡ç¨‹ï¼Œä¸æ˜¯ä¸€æ¬¡æ€§ä»»åŠ¡ã€‚ä¿æŒå°æ­¥å¿«è·‘ï¼ŒæŒç»­ä¼˜åŒ–ï¼
